$code = @"
import ssl, socket, base64, textwrap

host = "repo.anaconda.com"
port = 443

ctx = ssl.SSLContext(ssl.PROTOCOL_TLS_CLIENT)
ctx.check_hostname = False
ctx.verify_mode = ssl.CERT_NONE

with socket.create_connection((host, port), timeout=10) as sock:
    with ctx.wrap_socket(sock, server_hostname=host) as ssock:
        der = ssock.getpeercert(binary_form=True)
        b64 = base64.b64encode(der).decode("ascii")
        print("-----BEGIN CERTIFICATE-----")
        for line in textwrap.wrap(b64, 64):
            print(line)
        print("-----END CERTIFICATE-----")
"@

$code | & "C:\ProgramData\anaconda3\python.exe" - | Set-Content -Encoding ascii "$env:USERPROFILE\repo_leaf.pem"
Write-Host "Wrote $env:USERPROFILE\repo_leaf.pem"
