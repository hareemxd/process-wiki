$code = @"
import ssl, socket, base64, textwrap
host="repo.anaconda.com"
ctx = ssl.SSLContext(ssl.PROTOCOL_TLS_CLIENT)
ctx.check_hostname=False
ctx.verify_mode=ssl.CERT_NONE

with socket.create_connection((host,443),timeout=10) as s:
    with ctx.wrap_socket(s,server_hostname=host) as ss:
        der = ss.getpeercert(binary_form=True)
        b64 = base64.b64encode(der).decode("ascii")
        print("-----BEGIN CERTIFICATE-----")
        for line in textwrap.wrap(b64, 64):
            print(line)
        print("-----END CERTIFICATE-----")
"@
$code | & "C:\ProgramData\anaconda3\python.exe" - | Set-Content -Encoding ascii "$env:USERPROFILE\repo_leaf.pem"
Write-Host "Wrote $env:USERPROFILE\repo_leaf.pem"
