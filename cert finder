$bundle = "C:\Users\David.Ricart\certs\cacert_with_zscaler.pem"
$lines  = Get-Content $bundle

# Find line numbers of each BEGIN CERTIFICATE
$beginIdx = for ($i=0; $i -lt $lines.Count; $i++) { if ($lines[$i] -match "BEGIN CERTIFICATE") { $i } }

# Grab the last two cert blocks (assuming you appended issuing + root last)
$last2 = $beginIdx | Select-Object -Last 2
for ($j=0; $j -lt $last2.Count; $j++) {
    $start = $last2[$j]
    $end   = ($lines[$start..($lines.Count-1)] | Select-String -Pattern "END CERTIFICATE" | Select-Object -First 1).LineNumber + $start - 1
    $out   = "$env:TEMP\appended_cert_$j.pem"
    $lines[$start..$end] | Set-Content -Encoding ascii $out
    Write-Host "Wrote $out"
}
